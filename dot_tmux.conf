# Configuration
# =============

# Mouse on
set -g mouse on

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color*:Tc"

# Use vim key bindings in copy mode
set -g mode-keys vi

# Bindings
# ========
# Change prefix from 'C-b' to 'M-Space'
unbind C-b
set-option -g prefix M-Space
bind-key M-Space send-prefix

# Split panes using i and v defaulting to current path
bind-key i split-window -v  -c '#{pane_current_path}'
bind-key v split-window -h  -c '#{pane_current_path}'
unbind '"' # Liberate default bindings
unbind %   # Liberate default bindings

# Kill window/pane without confirmation
bind-key & kill-window
bind-key x kill-pane

# Create new window defaulting to current path
bind c new-window -c '#{pane_current_path}'

# Break pane on a new window
bind-key b break-pane -d

# Show all the sessions
bind-key t choose-tree

# Zoom
bind-key Space resize-pane -Z

# Reload config file
bind-key r source-file ~/.tmux.conf \; display-message "~/.tmux.conf reloaded"

# Setup 'v' to begin selection as in Vim
bind-key -T copy-mode-vi 'v' send-keys -X begin-selection
bind-key -T copy-mode-vi 'y' send-keys -X copy-pipe-and-cancel 'reattach-to-user-namespace pbcopy'

# Update default binding of `Enter` to also use copy-pipe
unbind -T copy-mode-vi Enter
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n 'M-h' if-shell "$is_vim" 'send-keys M-h'  'select-pane -L'
bind-key -n 'M-j' if-shell "$is_vim" 'send-keys M-j'  'select-pane -D'
bind-key -n 'M-k' if-shell "$is_vim" 'send-keys M-k'  'select-pane -U'
bind-key -n 'M-l' if-shell "$is_vim" 'send-keys M-l'  'select-pane -R'
bind-key -T copy-mode-vi 'M-h' select-pane -L
bind-key -T copy-mode-vi 'M-j' select-pane -D
bind-key -T copy-mode-vi 'M-k' select-pane -U
bind-key -T copy-mode-vi 'M-l' select-pane -R

# Personalization
# ===============

# Disable notifications
set-option -g visual-activity off
set-option -g visual-bell off
set-option -g visual-silence off
set-window-option -g monitor-activity off
set-option -g bell-action none

set -g status-position bottom
set -g status-left ''
set -g status-right ''
set -g status-right-length 100
set -g status-left-length 20

# Onenord theme (rmehri01/onenord.nvim/)
# =============

# background_color '#2E3440'
# current_line_color '#4E4450'
# foreground_color '#E5E9F0'
# comment_color '#646A76'
# cyan '#88C0D0'
# green '#A3BE8C'
# orange '#D08F70'
# pink '#E85B7A'
# purple '#B988B0'
# red '#D57780'
# yellow '#EBCB8B'
set -g pane-border-style fg='#4E4450'
set -g pane-active-border-style fg='#E85B7A'

# message text
set -g message-style bg='#646A76',fg='#88C0D0'

# status line
set -g status-style bg='#4E4450',fg='#E85B7A'
set -g status-interval 1

# status right
# are we zoomed into a pane?
set -g status-right '#[bg=#4E4450]#{?window_zoomed_flag,#[bg=#A3BE8C],}  '
# are we controlling tmux or the content of the panes?
set -ga status-right '#[bg=#4E4450]#{?client_prefix,#[bg=#E85B7A]#[fg=#646A76],}  '

# window status
set-window-option -g window-status-style fg='#E85B7A',bg=default
set-window-option -g window-status-current-style fg='#E85B7A',bg='#2E3440'
set -g window-status-current-format "#[fg=#E5E9F0]#[bg=#E85B7A] #I #W "
set -g window-status-format "#[fg=#E5E9F0]#[bg=#4E4450] #I #W "

# Enable undercurl for nvim lsp errors
set -g default-terminal "${TERM}"
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'  # undercurl support
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'  # underscore colours - needs tmux-3.0

# nvim :checkhealth recommend this settings
set-option -sg escape-time 10
set-option -g focus-events on

# List of plugins
# =================
set -g @plugin 'tmux-plugins/tpm'               # Tmux plugin manager
set -g @plugin 'tmux-plugins/tmux-sensible'     # TODO: Document
# set -g @plugin 'christoomey/vim-tmux-navigator' # Awesome navigation between vim and tmux
# set -g @plugin 'tmux-plugins/tmux-copycat'      # Search using `prefix + /`
# set -g @plugin 'tmux-plugins/tmux-open'         # Opens files highlighted using `o`
# set -g @plugin 'tmux-plugins/tmux-yank'         # Yanks with `y`

run -b '~/.tmux/plugins/tpm/tpm'
